version: 1
env:
  variables:
    # Environment variables for Amplify Gen 2
    _LIVE_UPDATES: '[{"name":"Amplify CLI","pkg":"@aws-amplify/cli","type":"npm","version":"latest"}]'
backend:
  phases:
    preBuild:
      commands:
        # Install dependencies for Amplify backend
        - npm ci
        # Install Amplify CLI globally if not available
        - npm install -g @aws-amplify/cli@latest
    build:
      commands:
        # Set CI environment variable
        - export CI=1
        # Deploy Amplify Gen 2 backend
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
  cache:
    paths:
      - node_modules/**/*
      - amplify/.amplify/**/*
frontend:
  phases:
    preBuild:
      commands:
        - echo "This is a React Native mobile app - no web frontend build required"
    build:
      commands:
        # Create a minimal index.html to satisfy Amplify hosting requirements
        - mkdir -p dist
        - echo '<!DOCTYPE html><html><head><title>Hakuba Mobile App</title></head><body><h1>Hakuba Mobile App</h1><p>This is a React Native mobile application. Please download the app from the App Store or Google Play.</p></body></html>' > dist/index.html
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
